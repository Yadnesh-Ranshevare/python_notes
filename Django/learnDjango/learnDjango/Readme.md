# Views and url mapping

#### view( views.py )
view is a function or class that receives a web request and returns a web response. The response can contain HTML content, redirections, images, JSON data, or any other form of content.
```python
from django.http import  HttpResponse

def home(request):
    return HttpResponse("Hello, World! This is my first Django app.")
```

you can also return a html response, to do that you need to first create a template which will get rendered on request
- the template
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn Django</title>
</head>
<body>
    <h1>Learn Django template</h1>
</body>
</html>
```

- the view
```python
def template(request):
    return render(request, 'template_path')
```

#### url mapping( urls.py )
URL mapping in Django refers to the process of linking a specific URL (Uniform Resource Locator) pattern to a corresponding view function or class
example considering above view
```python
#inside the urls.py file 
from django.contrib import admin
from django.urls import path
from . import views     #import views

urlpatterns = [
    path('admin/', admin.site.urls),
    path('home/',views.home),       #add this path
    path('templates/', views.template)      #add this path
]
```



---

# Django Database Setup and Model Explanation

### Database Configuration in `settings.py`:

- Django uses SQLite3 as its default database, but it can work with other databases too (like PostgreSQL, MySQL, etc.).

- In your `settings.py`, the `DATABASES` setting configures how Django connects to the database. The configuration you provided uses SQLite3 as the database engine and stores the database file (`db.sqlite3`) in the base directory (`BASE_DIR`).

```python
# settings.py
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',  # Use SQLite3 database engine
        'NAME': BASE_DIR / 'db.sqlite3',  # The location of the database file
    }
}
```

 ###  Creating Models in models.py:
 - In Django, a model is a Python class that represents a table in the database. Each attribute in the class corresponds to a column in the table.

- The model class inherits from django.db.models.Model, and you define fields (columns) as class attributes using different field types provided by Django (like CharField, ImageField, DateTimeField, etc.).

Here's a detailed breakdown of the model with example of user model:

 ```python
# firstApp/models.py
from django.db import models  # Importing the models module from Django
from django.utils import timezone  # Importing timezone to set the current time as default

class UserModel(models.Model):
    # A tuple defining the types of users. Choices are either 'normal' or 'admin'.
    USER_TYPES = (('normal', 'Normal User'), ('admin', 'Administrator'))
    
    # The name of the user (max 100 characters).
    name = models.CharField(max_length=100)

    # Image field to store the user's image in a directory called 'user/images/'.
    image = models.ImageField(upload_to='user/images/')

    # The date when the user was added, with the default value being the current time.
    date_added = models.DateTimeField(default=timezone.now)

    # A choice field for the user type. It can be either 'normal' or 'admin'.
    type = models.CharField(max_length=6, choices=USER_TYPES)

    def __str__(self):
        return self.name
```
 #### By overriding the `__str__()` method to return self.name, you are telling Django that whenever you try to display a UserModel object (in the admin panel, for example), it should show the user's name (instead of something less human-readable like a memory address or an autogenerated ID).


You need to install the Pillow library in Django when you work with images, specifically if you're using the ImageField in your models,

When you define an ImageField in your model, Django needs to be able to validate and store images in the file system, as well as provide utilities for resizing or cropping images if needed. Pillow does this job by providing the necessary image processing functions.

To install Pillow, simply run the following command in your terminal:

```bash
pip install Pillow
```
### Storing Media Files (Images) in Django

In Django, media files (like images, videos, PDFs, etc.) are files that are uploaded by users. To store and serve these files, you need to configure two things in Django: `MEDIA_URL` and `MEDIA_ROOT` in `settings.py`, and you also need to adjust the URLs to serve media files correctly.

- `MEDIA_URL`: This is the URL that will be used to access the media files (like images) through the browser. It is a public URL path.

-  `MEDIA_ROOT`: This is the directory path on your file system where the media files will be stored. This is where Django will save the uploaded files.

Here’s how you configure them in settings.py:

```python
# settings.py

import os  # Make sure you import 'os' to handle file paths

# The URL to access uploaded media files in the browser.
MEDIA_URL = '/media/'

# The path where uploaded media files will be stored on the filesystem.
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')

```

By default, Django does not serve media files (like images, PDFs, etc.) during development. To make sure Django can serve media files while you're working locally (in development), you need to adjust the URLs in urls.py.

Here’s how you configure it:
```python
# urls.py

from django.contrib import admin
from django.urls import path, include
from django.conf import settings  # To access settings like MEDIA_URL and MEDIA_ROOT
from django.conf.urls.static import static  # To serve media files

urlpatterns = [
    path('admin/', admin.site.urls),  # The admin URL path
] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

### Migrations:
Django uses migrations to keep track of changes you make to your models and apply those changes to the database. Migrations are basically a way to synchronize the changes in your models (Python code) with the actual database (SQL tables).
```bash
python manage.py makemigrations 
```
this will make the migrations of whole Django project but if want to make migrations of only specific Django app then
```bash
python manage.py makemigrations <app_name>
```

this create a `migrations` folder in to your respective app. These files contain instructions for how to apply, roll back, and manage changes to the database structure over time

```bash
migrations/
    ├── __pycache
    ├── __init.py
    └── 0001_initial.py       
```

- The `__init__.py` file is usually empty.
You don’t need to modify this file; it’s there to ensure that Django can find and run migration scripts.

-  `0001_initial.py` is a file that contains instructions for Django to create the database schema for your app based on the models you defined in models.py.  It contains Python code that describes how to create or modify database tables, fields, indexes, and other schema elements. Here's a simplified example
```python
from django.db import migrations, models

class Migration(migrations.Migration):

    dependencies = []

    operations = [
        migrations.CreateModel(
            name='UserModel',
            fields=[
                #your model information
            ],
        ),
    ]
```
### Migrate:
Django doesn't automatically apply the changes to the database when you modify your models. Instead, it requires you to manually create migration files using makemigrations and then apply those migrations to the database using migrate.

```bash
python manage.py migrate
```
This will update the database based on the migration files, like creating new tables, adding/removing columns, or modifying relationships.


By registering a model in the admin.py file, we are enabling it to be managed through Django's built-in admin interface. This means that once the model is registered, you can use the Django admin panel to add, view, update, and delete records of that model.   
```python
# firstApp/admin.py
from django.contrib import admin  # Import Django's admin module
from .models import UserModel     # Import the UserModel from models.py

# Register your models here
admin.site.register(UserModel)  # Register UserModel with the admin site
```
- After logging into the admin panel, Under the firstApp section, you will see the UserModel listed. by clicking on add button you can store the data into database for that model

### connecting frontend
- `views.py`
```python
from .models import UserModel #imports the UserModel class, which represents the users in your database.

def user(request):
    user = UserModel.objects.all()  # Query all users from the database
    return render(request, 'firstApp/user.html', {'users': user}) #The template will receive this data and display it in the HTML using the users context variable.
```

- `urls.py`
```python
from django.urls import path
from . import views

urlpatterns = [
    path('users', views.user, name="users"),
]
```
- `user.html`
```html
{% extends "layout.html" %}

{% block title %}
users
{% endblock %}

{% block content %} 

{% for user in users %}  <!--for loop in Django templates-->
 <div>
    <img src="{{user.image.url}}" alt="" style="width: 100px;">
    <p>{{user.name}}</p>
 </div>
{% endfor %}

{% endblock %}
```

### dynamic routing
- `urls.py`
```python
from django.urls import path
from . import views

urlpatterns = [
    path('users', views.user, name="users"),
    path('users/<str:userName>/', views.userName, name="userName"),
]
```


- `views.py`
```python
from django.shortcuts import render
from .models import UserModel 
from django.shortcuts import get_object_or_404

def user(request):
    user = UserModel.objects.all()
    return render(request, 'firstApp/user.html', {'users': user})
```
- `UserModel.objects.all()` It retrieves all user records from the UserModel table and returns a queryset containing all the user entries in the database.



- `user.html`
```html
{% extends "layout.html" %}

{% block title %}
users
{% endblock %}

{% block content %}
<h1>content of layout.html</h1>


{% for user in users %}
 <div>
    <a href= "{% url 'userName' user.name  %}">{{user.name}}</a>
 </div>
{% endfor %}

{% endblock %}
```

- `{% url 'userName' user.name %}` is a Django template tag that generates the URL

- The `'userName'` is the name of the URL pattern (from urls.py), 

- `user.name` is the dynamic value passed along with URL.
- `genrated url`: in our example
```bash
.../users/<user.name>/
```

- `urls.py`
this url will be handled by this function
```python
path('users/<str:userName>/', views.userName, name="userName"),
```

- The `<str:userName>` part indicates that the userName portion of the URL will be captured and passed as a parameter
- `views.py`
```python
def userName(request,userName):
    user = get_object_or_404(UserModel, name=userName)
    return render(request, 'firstApp/userName.html', {'user': user})
```
- accept the url parameter along with the request
- `get_object_or_404` is a utility function that attempts to retrieve a single object from the database. If the object is not found, it raises an HTTP 404 error

- `userName.html`
```html
{% extends "layout.html" %}

{% block content %}
    <h1>user name image is</h1>

    <h2>{{user.name}}</h2>
    <img src="{{user.image.url}}" alt="" style="width: 100px;">
{% endblock %}
```